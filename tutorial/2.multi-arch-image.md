## buildx ##

![](https://github.com/gnosia93/eks-grv-mig/blob/main/tutorial/images/ec2-1.png)

```
$ ssh -i aws-kp-2.pem ubuntu@ec2-43-203-216-190.ap-northeast-2.compute.amazonaws.com
```


buildx 플러그인 설치한 후, 
```
$ sudo apt-get install docker-buildx-plugin
```
아래와 같이 빌더를 하나 만들어 준다. 
```
$ sudo docker buildx create --name multiarch --bootstrap --use

$ sudo docker buildx inspect multiarch
```


ecr 에 로그인한다.
```
$ sudo apt install -y awscli

$ aws ecr get-login-password --region ap-northeast-2 | docker login --username AWS --password-stdin \
aws_account_id.dkr.ecr.regionID.amazonaws.com
```


arm64 및 amd64 용 멀티이미지를 만들어서 docker hub 에 푸시한다.
```
$ docker buildx build --push \
  --platform linux/arm64,linux/amd64 \
  --tag controlftp/vmg:v14 .
```



## 인스턴스 타입별로 빌드하기 ##


## 레퍼런스 ##
* [Multi-Architecture Docker Image](https://medium.com/illumination/multi-architecture-docker-image-3637ba05e5eb)
* [Integrate Jenkins with Amazon ECR](https://medium.com/@lilnya79/integrate-jenkins-with-amazon-ecr-4946ca5b86e1)
* https://www.eksworkshop.com/docs/fundamentals/managed-node-groups/graviton/scheduling-graviton
